/*! gaoerjunLib 2015-03-04 */
function Game(){this.playing=0,this.started=0,this.gameover=0,this.won=0}function doMove(a){for(var b=!1,c=1;4>=c;c++)updateLine(c,a)&&(b=!0);if(b){newBlock();var d=$(".count").html();d=parseInt(d,10)+3,$(".count").html(d)}else $(".err_tip").html("请换个方向移动~"),setTimeout(function(){$(".err_tip").html("")},1e3)}function newBlock(){var a=Math.floor(Math.random()*blankArr.length+1),b=getBlankPosByNum(blankArr[a-1]);updateBlock(b.x,b.y,Math.random()<.9?2:4),blankArr.splice(a-1,1),0==blankArr.length&&isFinish()&&(window.confirm("game over,是否重新开始？"),restartGame())}function restartGame(){for(var a=1;4>=a;a++)for(var b=1;4>=b;b++)updateBlock(a,b,0);blankArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],newBlock(),newBlock()}function isFinish(){if(blankArr.length>0)return!1;for(var a=!0,b=1;4>=b;b++)for(var c=1;4>=c;c++){var d=$("#"+b+"_"+c).html();if(4>b){var e=$("#"+(b+1)+"_"+c).html();if(e==d){a=!1;break}}if(4>c){var f=$("#"+b+"_"+(c+1)).html();if(f==d){a=!1;break}}}return a}function updateLine(a,b){var c=!1,d=[],e=4;for(("left"==b||"up"==b)&&(e=1);;){if(("left"==b||"up"==b)&&e>4)break;if(("right"==b||"down"==b)&&0>e)break;var f=$("#"+a+"_"+e);("up"==b||"down"==b)&&(f=$("#"+e+"_"+a));var g=f.html();g>0&&d.push(g),"up"==b||"left"==b?e++:e--}for(var h=0;h<d.length;h++)if(h<=d.length-2&&d[h]==d[h+1]){d[h]=parseInt(d[h],10)-0+parseInt(d[h+1],10);var i=$(".count").html();i=parseInt(i,10)+d[h],$(".count").html(i);for(var j=h+1;j<d.length;j++)j+1<=d.length-1&&(d[j]=d[j+1]);d.splice(d.length-1,1)}for(var h=d.length||0;4>h;h++)d[h]=0;if("left"==b)for(var h=1;4>=h;h++){var g=d[h-1];updateBlock(a,h,g)&&(c=!0)}else if("right"==b)for(var h=4;h>=1;h--){var g=d[4-h];updateBlock(a,h,g)&&(c=!0)}else if("up"==b)for(var h=1;4>=h;h++){var g=d[h-1];updateBlock(h,a,g)&&(c=!0)}else if("down"==b)for(var h=4;h>=1;h--){var g=d[4-h];updateBlock(h,a,g)&&(c=!0)}return c}function updateBlock(a,b,c){var d=$("#"+a+"_"+b),e=d.html();if(e==c||""==e&&0==c){if(0==c){var f=getBlankNumByPos(a,b);blankArr.push(f)}return!1}if(c>0)d.attr("class","i_block item"+c).html(c);else{var f=getBlankNumByPos(a,b);blankArr.push(f),d.attr("class","i_block").html("")}return!0}function getBlankNumByPos(a,b){for(var c=0;c<m_posMap.length;c++)if(m_posMap[c].pos==a+"_"+b)return m_posMap[c].key}function getBlankPosByNum(a){for(var b=0;b<m_posMap.length;b++)if(m_posMap[b].key==a){var c=m_posMap[b].pos.split("_");return{x:c[0],y:c[1]}}}function eventDown(a){if(a.preventDefault(),a.targetTouches)var b=a.targetTouches[0];m_startX=a.clientX||a.pageX||b.pageX,m_startY=a.clientY||a.pageY||b.pageY,moveX=0,moveY=0}function eventUp(a){if(a.preventDefault(),Math.abs(moveX)>Math.abs(moveY))blankArr=[],doMove(moveX>0?"right":"left");else{if(Math.abs(moveY)<=10)return!1;blankArr=[],doMove(moveY>0?"down":"up")}}function eventMove(a){if(a.preventDefault(),a.targetTouches)var b=a.targetTouches[0];var c=a.clientX||a.pageX||b.pageX,d=a.clientY||a.pageY||b.pageY;moveX=c-m_startX,moveY=d-m_startY}$(function(){newBlock(),newBlock();var a=document.getElementById("canvas");a.addEventListener("touchstart",eventDown),a.addEventListener("touchend",eventUp),a.addEventListener("touchmove",eventMove),a.addEventListener("mousedown",eventDown),a.addEventListener("mouseup",eventUp),a.addEventListener("mousemove",eventMove)});var blankArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],m_startX=0,m_startY=0;